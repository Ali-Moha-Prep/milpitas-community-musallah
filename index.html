<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Milpitas Community Masjid</title>
    <meta name="description" content="Milpitas Community Masjid - Daily prayer times, Jumu'ah, and community services at 90 Dempsey Rd, Milpitas, CA 95035." />
    <meta property="og:title" content="Milpitas Community Masjid" />
    <meta property="og:description" content="A place for prayer, community, and connection. View daily prayer times and support the musallah." />
    <meta property="og:type" content="website" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container header-content">
        <div class="logo-wrapper">
          <img src="logo.png.jpeg" alt="Milpitas Community Musallah Logo" class="logo" />
        </div>
        <div class="title-wrapper">
          <h1>Milpitas Community Masjid</h1>
          <p class="tagline">A place for prayer, community, and connection</p>
        </div>
      </div>
    </header>

    <main>
      <section class="section section-prayer-times">
        <div class="container">
          <h2>Prayer Times</h2>
          <p class="section-note">
            Adhan times are updated live daily. Iqamah times are set by the musallah.
          </p>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Prayer</th>
                  <th>Adhan</th>
                  <th>Iqamah</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Fajr</td>
                  <td id="adhan-fajr">—</td>
                  <td id="iqamah-fajr">6:05 AM</td>
                </tr>
                <tr>
                  <td>Dhuhr</td>
                  <td id="adhan-dhuhr">—</td>
                  <td id="iqamah-dhuhr">12:30 PM</td>
                </tr>
                <tr>
                  <td>Asr</td>
                  <td id="adhan-asr">—</td>
                  <td id="iqamah-asr">4:45 PM</td>
                </tr>
                <tr>
                  <td>Maghrib</td>
                  <td id="adhan-maghrib">—</td>
                  <td id="iqamah-maghrib">+5 minutes</td>
                </tr>
                <tr>
                  <td>Isha</td>
                  <td id="adhan-isha">—</td>
                  <td id="iqamah-isha">8:00 PM</td>
                </tr>
                <tr>
                  <td>Jumu'ah</td>
                  <td id="adhan-jumuah">—</td>
                  <td id="iqamah-jumuah">1:30 PM</td>
                </tr>
              </tbody>
            </table>
          </div>
          <p class="section-note prayer-times-note" id="prayer-date"></p>
        </div>
      </section>

      <section class="section section-donation">
        <div class="container donation-layout">
          <div>
            <h2>Support the Musallah</h2>
            <p class="donation-message">
              <strong>Donate generously!</strong> Your contributions help maintain the masjid, support
              programs, and serve the local community.
            </p>
            <ul class="donation-list">
              <li>Zelle: <span class="highlight">90dempsey@gmail.com</span></li>
              <li>Check: <span class="highlight">Write a check to MCM</span></li>
            </ul>
            <p class="tax-deductible-notice">
              Donations are tax deductible! Taxpayer ID # 88-2365109
            </p>
            <p class="standalone-note">
              Note: This is a standalone masjid and is not backed by any organization.
            </p>
          </div>
          <div class="donation-qr-wrapper">
            <img src="donation-qr.png.jpeg" alt="Zelle Donation QR Code" class="donation-qr" />
            <p class="donation-caption">Scan to donate via Zelle</p>
          </div>
        </div>
      </section>

      <section class="section section-location">
        <div class="container">
          <h2>Location</h2>
          <p class="address">
            90 Dempsey Rd, Milpitas, CA 95035
          </p>
          <p class="section-note parking-note">
            Please be considerate when parking. Do not block driveways or pathways, and park in a manner that allows others to enter and exit with ease. Jazakum Allahu Khairan.
          </p>
          <div class="map-embed">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3168.2!2d-121.9!3d37.43!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2z90+Dempsey+Rd+Milpitas+CA!5e0!3m2!1sen!2sus!4v1700000000000"
              width="100%"
              height="250"
              style="border:0; border-radius: 18px;"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              title="Milpitas Community Masjid Location"
            ></iframe>
          </div>
          <a
            href="https://maps.app.goo.gl/tqur8Z7AS14meRub6"
            target="_blank"
            rel="noopener noreferrer"
            class="map-link"
          >
            Open in Google Maps
          </a>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container footer-content">
        <p>&copy; <span id="year"></span> Milpitas Community Musallah. All rights reserved.</p>
      </div>
    </footer>

    <script>
      // Set current year in footer
      document.getElementById("year").textContent = new Date().getFullYear();

      // Show today's date next to prayer times
      const today = new Date();
      const dateStr = today.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      document.getElementById("prayer-date").textContent = dateStr;

      // ——— Prayer times: Adhan from API, Iqamah fixed by musallah ———
      const IQAMAH = {
        Fajr: '6:05 AM',
        Dhuhr: '12:30 PM',
        Asr: '4:45 PM',
        Maghrib: '+5 minutes',
        Isha: '8:00 PM',
        Jumuah: '1:30 PM'
      };

      function format24to12(time24) {
        if (!time24 || time24.length < 5) return time24;
        // Strip any timezone suffix like " (PST)" from API response
        const clean = time24.split(' ')[0];
        const [h, m] = clean.split(':').map(Number);
        if (isNaN(h) || isNaN(m)) return time24;
        const period = h >= 12 ? 'PM' : 'AM';
        const h12 = h % 12 || 12;
        return h12 + ':' + (m < 10 ? '0' : '') + m + ' ' + period;
      }

      function setPrayerCell(id, text) {
        const el = document.getElementById(id);
        if (el) el.textContent = text;
      }

      async function fetchPrayerTimes() {
        const params = new URLSearchParams({
          city: 'Milpitas',
          country: 'United States',
          state: 'California',
          // Custom method with 18° angles for Fajr and Isha
          method: '99',
          fajr: '18',
          isha: '18'
        });
        const url = 'https://api.aladhan.com/v1/timingsByCity?' + params.toString();

        try {
          const res = await fetch(url);
          const json = await res.json();
          const t = json?.data?.timings;
          if (!t) throw new Error('Invalid response');

          setPrayerCell('adhan-fajr', format24to12(t.Fajr));
          setPrayerCell('adhan-dhuhr', format24to12(t.Dhuhr));
          setPrayerCell('adhan-asr', format24to12(t.Asr));
          setPrayerCell('adhan-maghrib', format24to12(t.Maghrib));
          setPrayerCell('adhan-isha', format24to12(t.Isha));
          setPrayerCell('adhan-jumuah', format24to12(t.Dhuhr));

          setPrayerCell('iqamah-fajr', IQAMAH.Fajr);
          setPrayerCell('iqamah-dhuhr', IQAMAH.Dhuhr);
          setPrayerCell('iqamah-asr', IQAMAH.Asr);
          setPrayerCell('iqamah-maghrib', IQAMAH.Maghrib);
          setPrayerCell('iqamah-isha', IQAMAH.Isha);
          setPrayerCell('iqamah-jumuah', IQAMAH.Jumuah);
        } catch (e) {
          setPrayerCell('adhan-fajr', '5:19 AM');
          setPrayerCell('adhan-dhuhr', '12:22 PM');
          setPrayerCell('adhan-asr', '4:15 PM');
          setPrayerCell('adhan-maghrib', 'Sunset');
          setPrayerCell('adhan-isha', '7:23 PM');
          setPrayerCell('adhan-jumuah', '12:21 PM');
          setPrayerCell('iqamah-fajr', IQAMAH.Fajr);
          setPrayerCell('iqamah-dhuhr', IQAMAH.Dhuhr);
          setPrayerCell('iqamah-asr', IQAMAH.Asr);
          setPrayerCell('iqamah-maghrib', IQAMAH.Maghrib);
          setPrayerCell('iqamah-isha', IQAMAH.Isha);
          setPrayerCell('iqamah-jumuah', IQAMAH.Jumuah);
        }
      }

      fetchPrayerTimes();
    </script>
  </body>
</html>
