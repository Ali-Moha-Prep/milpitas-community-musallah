<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Milpitas Community Musallah</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container header-content">
        <div class="logo-wrapper">
          <!-- Replace logo.png with your actual logo file name -->
          <img src="logo.png.jpeg" alt="Milpitas Community Musallah Logo" class="logo" />
        </div>
        <div class="title-wrapper">
          <h1>Milpitas Community Musallah</h1>
          <p class="tagline">A place for prayer, community, and connection</p>
        </div>
      </div>
    </header>

    <main>
      <section class="section section-prayer-times">
        <div class="container">
          <h2>Prayer Times</h2>
          <p class="section-note">
            Timings are updated daily for Milpitas, CA using the 18-degree angle calculation method (Muslim World League).
          </p>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Prayer</th>
                  <th>Adhan</th>
                  <th>Iqamah</th>
                </tr>
              </thead>
              <tbody id="prayer-times-body">
                <tr>
                  <td colspan="3" style="text-align: center; padding: 20px;">Loading prayer times...</td>
                </tr>
              </tbody>
            </table>
          </div>
          <p class="section-note" style="margin-top: 10px; font-size: 0.9em;">
            <em>Last updated: <span id="last-updated">--</span></em>
          </p>
        </div>
      </section>

      <section class="section section-donation">
        <div class="container donation-layout">
          <div>
            <h2>Support the Musallah</h2>
            <p class="donation-message">
              <strong>Donate generously!</strong> Your contributions help maintain the musallah, support
              programs, and serve the local community.
            </p>
            <ul class="donation-list">
              <li>Zelle: <span class="highlight">[Your Zelle ID / Email]</span></li>
              <!-- Add any additional donation options if you have them -->
            </ul>
          </div>
          <div class="donation-qr-wrapper">
            <!-- Replace donation-qr.png with your actual Zelle QR/scanner image file name -->
            <img src="donation-qr.png.jpeg" alt="Zelle Donation QR Code" class="donation-qr" />
            <p class="donation-caption">Scan to donate via Zelle</p>
          </div>
        </div>
      </section>

      <section class="section section-location">
        <div class="container">
          <h2>Location</h2>
          <!-- Replace the placeholder address below with the actual musallah address -->
          <p class="address">
            90 Dempsey Rd, Milpitas, CA 95035
          </p>
          <p class="section-note">
            <!-- Optional: add parking / entrance notes here -->
            Entrance and parking details can be added here.
          </p>
          <!--
            Optional: When you have the exact address, you can generate an embedded Google Map
            and paste the iframe here instead of (or in addition to) the link below.
          -->
          <a
            href="https://maps.app.goo.gl/tqur8Z7AS14meRub6"
            target="_blank"
            rel="noopener noreferrer"
            class="map-link"
          >
            Open in Google Maps
          </a>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container footer-content">
        <p>&copy; <span id="year"></span> Milpitas Community Musallah. All rights reserved.</p>
      </div>
    </footer>

    <script>
      // Set current year in footer
      document.getElementById("year").textContent = new Date().getFullYear();

      // Fetch prayer times from Aladhan API (18-degree angle - Muslim World League)
      async function fetchPrayerTimes() {
        try {
          const today = new Date();
          const year = today.getFullYear();
          const month = String(today.getMonth() + 1).padStart(2, '0');
          const date = String(today.getDate()).padStart(2, '0');

          // Milpitas, CA coordinates: 37.4128° N, 121.9949° W
          // Method 3 = Muslim World League (18-degree angle for Fajr and Isha)
          const url = `https://api.aladhan.com/v1/timings/${date}-${month}-${year}?latitude=37.4128&longitude=-121.9949&method=3&midnightMode=Standard&school=1`;

          const response = await fetch(url);
          const data = await response.json();

          if (data.code === 200) {
            const timings = data.data.timings;

            // Format time to 12-hour format
            function formatTime(time24) {
              const [hours, minutes] = time24.split(':');
              let hours12 = parseInt(hours);
              const ampm = hours12 >= 12 ? 'PM' : 'AM';
              hours12 = hours12 % 12 || 12;
              return `${hours12}:${minutes} ${ampm}`;
            }

            // Calculate Iqamah times (typically 10-15 minutes after Adhan)
            const prayerData = [
              { name: 'Fajr', adhan: timings.Fajr, iqamahOffset: 15 },
              { name: 'Dhuhr', adhan: timings.Dhuhr, iqamahOffset: 10 },
              { name: 'Asr', adhan: timings.Asr, iqamahOffset: 10 },
              { name: 'Maghrib', adhan: timings.Maghrib, iqamahOffset: 5 },
              { name: 'Isha', adhan: timings.Isha, iqamahOffset: 15 },
              { name: 'Jumu\'ah', adhan: timings.Dhuhr, iqamahOffset: 40 } // Jumu'ah typically 40 minutes after Dhuhr Adhan
            ];

            function calculateIqamah(time24, offsetMinutes) {
              const [hours, minutes] = time24.split(':').map(Number);
              const totalMinutes = hours * 60 + minutes + offsetMinutes;
              const newHours = Math.floor(totalMinutes / 60) % 24;
              const newMinutes = totalMinutes % 60;
              return `${String(newHours).padStart(2, '0')}:${String(newMinutes).padStart(2, '0')}`;
            }

            const tbody = document.getElementById('prayer-times-body');
            tbody.innerHTML = '';

            prayerData.forEach(prayer => {
              const iqamah = calculateIqamah(prayer.adhan, prayer.iqamahOffset);
              const row = `
                <tr>
                  <td>${prayer.name}</td>
                  <td>${formatTime(prayer.adhan)}</td>
                  <td>${formatTime(iqamah)}</td>
                </tr>
              `;
              tbody.innerHTML += row;
            });

            // Update last updated timestamp
            const now = new Date();
            const timeString = now.toLocaleString('en-US', { 
              month: 'short', 
              day: 'numeric', 
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit',
              second: '2-digit'
            });
            document.getElementById('last-updated').textContent = timeString;

          } else {
            throw new Error('Failed to fetch prayer times');
          }
        } catch (error) {
          console.error('Error fetching prayer times:', error);
          const tbody = document.getElementById('prayer-times-body');
          tbody.innerHTML = `
            <tr>
              <td colspan="3" style="text-align: center; color: red; padding: 20px;">
                Unable to load prayer times. Please try refreshing the page.
              </td>
            </tr>
          `;
        }
      }

      // Fetch prayer times when page loads
      fetchPrayerTimes();

      // Refresh prayer times every 24 hours
      setInterval(fetchPrayerTimes, 24 * 60 * 60 * 1000);
    </script>
  </body>
</html>